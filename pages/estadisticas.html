<div class="row">
  <div class="col-12">
    <div class="mb-4">
      <h4 class="mb-0">Estadísticas del Sistema</h4>
      <p class="text-muted">Análisis y métricas del sistema de gestión de convenios</p>
    </div>
  </div>
</div>

<!-- Filtros de Estadísticas -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="row align-items-end">
          <div class="col-md-4 mb-3 mb-md-0">
            <label for="filterCategoria" class="form-label">Filtrar por Categoría</label>
            <select class="form-select" id="filterCategoria">
              <option value="">Todas las categorías</option>
              <option value="convenios">Convenios</option>
              <option value="instituciones">Instituciones</option>
              <option value="homologaciones">Homologaciones</option>
              <option value="usuarios">Usuarios</option>
            </select>
          </div>
          <div class="col-md-4 mb-3 mb-md-0">
            <label for="filterSubcategoria" class="form-label">Subcategoría</label>
            <select class="form-select" id="filterSubcategoria">
              <option value="">Todas</option>
            </select>
          </div>
          <div class="col-md-4">
            <button type="button" class="btn btn-primary w-100" id="btnAplicarFiltros">
              <i class="bi bi-search"></i> Buscar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Tarjetas de Resumen -->
<div class="row mb-4" id="resumen-cards">
  <!-- Se llenarán dinámicamente -->
  <div class="col-12 text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Cargando estadísticas...</p>
  </div>
</div>

<!-- Gráficos -->
<div class="row mb-4">
  <!-- Gráfico de Convenios por Estado -->
  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title mb-4">
          <i class="bi bi-pie-chart-fill text-primary"></i> 
          Convenios por Estado
        </h5>
        <div id="chartConveniosEstado" style="min-height: 300px;">
          <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráfico de Convenios por Tipo -->
  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title mb-4">
          <i class="bi bi-bar-chart-fill text-success"></i> 
          Convenios por Tipo
        </h5>
        <div id="chartConveniosTipo" style="min-height: 300px;">
          <div class="text-center py-5">
            <div class="spinner-border text-success" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Gráficos Adicionales -->
<div class="row mb-4">
  <!-- Gráfico de Instituciones por Municipio -->
  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title mb-4">
          <i class="bi bi-geo-alt-fill text-warning"></i> 
          Instituciones por Municipio
        </h5>
        <div id="chartInstitucionesMunicipio" style="min-height: 300px;">
          <div class="text-center py-5">
            <div class="spinner-border text-warning" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráfico de Homologaciones por Nivel -->
  <div class="col-md-6 mb-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title mb-4">
          <i class="bi bi-graph-up text-info"></i> 
          Homologaciones por Nivel Académico
        </h5>
        <div id="chartHomologacionesNivel" style="min-height: 300px;">
          <div class="text-center py-5">
            <div class="spinner-border text-info" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Tabla de Estadísticas Detalladas -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title mb-4">
          <i class="bi bi-table"></i> 
          Estadísticas Detalladas
        </h5>
        <div class="table-responsive">
          <table class="table table-hover align-middle">
            <thead>
              <tr>
                <th>Categoría</th>
                <th>Nombre</th>
                <th>Subcategoría</th>
                <th class="text-end">Cantidad</th>
                <th class="text-end">Suma Total</th>
                <th class="text-center">Última Actualización</th>
              </tr>
            </thead>
            <tbody id="tablaEstadisticas">
              <tr>
                <td colspan="6" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                  <p class="mt-2 text-muted">Cargando datos...</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Error -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-body text-center p-5">
        <div class="mb-4">
          <div class="rounded-circle bg-danger d-inline-flex align-items-center justify-content-center" 
               style="width: 80px; height: 80px;">
            <i class="bi bi-x-lg text-white" style="font-size: 3rem;"></i>
          </div>
        </div>
        <h4 class="mb-3" id="errorModalTitle">¡Error!</h4>
        <p class="text-muted mb-4" id="errorModalMessage">
          Ocurrió un error al cargar las estadísticas.
        </p>
        <button type="button" class="btn btn-danger px-4" data-bs-dismiss="modal">
          <i class="bi bi-x-circle"></i> Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
